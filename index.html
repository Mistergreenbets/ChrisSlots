
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cat√°logo ‚Äì Rabisco & Arte</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
/* --- seu CSS original mantido (compactado aqui, sem mudan√ßas visuais) --- */
*{ margin:0; padding:0; box-sizing:border-box; font-family:"Poppins",sans-serif;}
body{ background:#F9F8FC; color:#6C5243; overflow-x:hidden; -webkit-font-smoothing:antialiased; }
.container-vermelho{ background:linear-gradient(90deg,#DED8CC,#ADAC8C); padding:12px; text-align:center; font-weight:600; }
.texto-branco{ color:#000000; }
header{ text-align:center; padding:35px 0; background:linear-gradient(180deg,#111,#111); border-bottom:2px solid #ADAC8C; position:relative; overflow:hidden; }
header img{ width:280px; max-width:80%; }
h3{text-align:center;margin:20px;color:#6C5243; letter-spacing:2px;}
.filtro-container{ display:flex; justify-content:center; flex-wrap:wrap; gap:12px; margin:25px 10px; }
.filtro-container button{ background: linear-gradient(135deg,#DED8CC,#ADAC8C); border: none; padding: 10px 18px; border-radius: 25px; font-weight: 600; color: #6C5243; cursor: pointer; transition: .22s ease; box-shadow: 0 4px 8px rgba(173,172,140,.3); }
.filtro-container button:hover { transform: translateY(-3px) scale(1.02); }
.filtro-container button.ativo { background:#111; color:#ADAC8C; box-shadow: 0 8px 20px rgba(0,0,0,.25); }
main{ max-width:1100px; margin:30px auto; display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:25px; padding:0 15px; }
.produto{ background:#fff; border-radius:18px; overflow:hidden; box-shadow:0 6px 15px rgba(173,172,140,.18); transition:.35s; transform: translateY(12px); opacity:0; position:relative; }
.produto.visivel{ transform: translateY(0); opacity:1; }
.produto:hover{ transform:scale(1.02); box-shadow:0 10px 25px rgba(0,0,0,.08); }
.produto img{width:100%; height:230px; object-fit:cover;}
.produto-content{padding:18px;}
.produto h2{color:#ADAC8C; margin-bottom:6px;}
.produto p{margin:8px 0; color: #6C5243; line-height:1.3;}
.preco{font-weight:800;color:#ADAC8C;font-size:1.05rem;}
.badge { position:absolute; top:12px; left:12px; background: linear-gradient(90deg,#b13f3f,#e06666); color:#fff; padding:6px 12px; border-radius:15px; font-size:11px; font-weight:700; text-transform:uppercase; box-shadow:0 3px 6px rgba(0,0,0,0.18); letter-spacing:1px; }
.actions{text-align:center;padding:14px 18px 22px;}
.actions button{ background:linear-gradient(135deg,#DED8CC,#ADAC8C,#DED8CC); border:none; color:#6C5243; padding:12px 26px; border-radius:30px; cursor:pointer; font-weight:700; box-shadow:0 4px 10px rgba(173,172,140,.35); transition:.25s; }
.actions button:hover{ transform:translateY(-3px); }
.whatsapp{ position:fixed; right:20px; bottom:20px; background:#25D366; color:#fff; padding:15px; border-radius:50%; font-size:20px; z-index:1000; box-shadow: 0 6px 18px rgba(0,0,0,.2); }
#modal{ position:fixed; inset:0; background:rgba(0,0,0,.7); display:none; justify-content:center; align-items:center; z-index:9999; }
.modal-premium{ background:#fff; width:92%; max-width:420px; padding:18px; border-radius:16px; text-align:center; position:relative; box-shadow:0 25px 50px rgba(0,0,0,.3); animation:modalIn .35s ease; }
@keyframes modalIn{ from{opacity:0; transform:scale(.9);} to{opacity:1; transform:scale(1);} }
.modal-close{ position:absolute; top:10px; right:14px; cursor:pointer; font-size:18px; color:#999; }
.modal-header h3{ margin-bottom:2px; color:#111; font-size:1.05rem; font-weight:800; line-height:1.2; }
.viewers{ margin:2px 0; color:#ADAC8C; font-size:12.5px; line-height:1.2; }
.modal-alert{ margin-top:2px; color:#ff3d8e; font-size:16px; font-weight:700; }
.modal-form input{ width:100%; padding:10px; margin:6px 0; border-radius:8px; border:1px solid #ddd; font-size:14px; }
.status-box{ margin:8px 0 6px; }
#desconto{ font-size:12.5px; }
#total{ font-weight:800; font-size:14px; margin-top:2px; }
.btn-whatsapp{ background:#25D366; border:none; width:100%; padding:14px; border-radius:12px; font-size:15px; color:#fff; font-weight:800; cursor:pointer; margin-top:8px; box-shadow:0 0 18px rgba(37,211,102,.5); transition:.25s; }
.btn-whatsapp:hover{ transform:scale(1.04); }
.modal-img{ width:100%; max-height:180px; object-fit:cover; border-radius:12px; margin-bottom:6px; }
/* FOOTER */
footer {
  background: #111;
  color: #aaa;
  text-align: center;
  padding: 25px 10px;
  border-top: 2px solid #c7a008;
}
footer p { font-size:0.92em; margin-bottom:8px; }
footer a { color:#ADAC8C; text-decoration:none; font-weight:700; }
footer a:hover { text-decoration:underline; }
.social-icons { margin-top:10px; }
.social-icons a { color:#ADAC8C; font-size:1.4em; margin: 0 10px; transition: transform 0.25s ease; }
.social-icons a:hover { transform:scale(1.15); color:#fff; }
.pagination-container { display:flex; justify-content:center; align-items:center; gap:15px; margin:30px 0 60px; }
.pagination-container button { background: linear-gradient(135deg,#DED8CC,#ADAC8C); border:none; padding:10px 18px; border-radius:30px; color:#6C5243; font-weight:700; cursor:pointer; box-shadow:0 4px 12px rgba(173,172,140,.32); }
.pagination-container button[disabled] { opacity:.45; cursor:not-allowed; transform:none; }
#page-info { color:#ADAC8C; font-weight:800; }
@media(max-width:900px){ .produto img{ height:200px; } }
@media(max-width:700px){
  main{
    grid-template-columns:repeat(2, 1fr);
  }

  .produto img{
    height:150px;
  }

  .produto h2{
    font-size:14px;
  }

  .produto p{
    font-size:12px;
  }

  .whatsapp{
    right:12px;
    bottom:12px;
  }
}
</style>
</head>
<body>

<div class="container-vermelho">
  <p class="texto-branco">‚è∞ √öltimos dias para encomendar sua cesta de fim de ano! Pedidos somente at√© 20/12.</p>
</div>

<header>
  <img src="imgs/logo.png" alt="Logo Rabisco & Arte">
</header>

<h3>CAT√ÅLOGO PREMIUM</h3>

<iframe src="banner.html" style="width:100%; height:260px; border:none; overflow:hidden;" loading="lazy"></iframe>

<!-- FILTROS -->
<div class="filtro-container" id="filtroContainer" aria-label="Filtrar produtos">
  <button data-cat="todos" class="ativo">Todos</button>
  <button data-cat="canecas">Canecas</button>
  <button data-cat="copos">Copos</button>
  <button data-cat="presentes">Presentes</button>
  <button data-cat="decoracao">Decora√ß√£o</button>
  <button data-cat="vestuario">Vestu√°rio</button>
</div>

<!-- PRODUTOS -->
<main id="catalogo"></main>

<!-- PAGINA√á√ÉO -->
<div class="pagination-container" aria-hidden="false">
  <button id="prev">‚óÄ Anterior</button>
  <span id="page-info">P√°gina 1 de 1</span>
  <button id="next">Pr√≥ximo ‚ñ∂</button>
</div>

<footer>
  <p>&copy; 2025 Rabisco & Arte. Todos os direitos reservados.</p>
  <p>Desenvolvido por <a href="#">Two Designer / Grupo Mega</a></p>
  <div class="social-icons">
    <a href="tel:+5585994083703"><i class="fas fa-phone"></i></a>
    <a href="https://instagram.com/rabisco.earte" target="_blank"><i class="fab fa-instagram"></i></a>
    <a href="https://wa.me/5585994083703?text=Oi!%20Quero%20mais%20informa%C3%A7%C3%B5es%20sobre%20os%20produtos%20personalizados." target="_blank"><i class="fab fa-whatsapp"></i></a>
  </div>
</footer>

<!-- WHATSAPP -->
<a class="whatsapp" href="https://wa.me/5585994083703?text=Oi!%20Quero%20mais%20informa%C3%A7%C3%B5es%20sobre%20os%20produtos%20personalizados." target="_blank" aria-label="WhatsApp">
  <i class="fab fa-whatsapp"></i>
</a>

<!-- MODAL -->
<div id="modal" aria-hidden="true">
  <div class="modal-premium" role="dialog" aria-modal="true">
    <span class="modal-close" onclick="fecharModal()">‚úñ</span>
    <img id="modalImg" class="modal-img" src="" alt="Produto">
    <div class="modal-header">
      <h3 id="produtoNome"></h3>
      <p class="modal-alert">üî• Alta procura ‚Äî personalize o seu agora!</p>
      <p id="viewers" class="viewers"></p>
    </div>
    <div class="modal-form">
  <input type="text" id="nome" placeholder="üë§ Seu nome">
  <input type="text" id="cidade" placeholder="üìç Cidade">
  <div class="status-box">
    <p id="total"></p>
  </div>
</div>

    <button class="btn-whatsapp" onclick="enviarPedido()"><i class="fab fa-whatsapp"></i> Finalizar no WhatsApp</button>
  </div>
</div>

<script>
/* ===== CAPTURA AUTOM√ÅTICA DE AFILIADO ===== */
(function(){
  const params = new URLSearchParams(window.location.search);
  const afiliado = params.get("afiliado"); // agora captura ?afiliado=xxxx
  if(afiliado){
    localStorage.setItem("afiliado", afiliado.trim().toUpperCase());
  }
})();
</script>


<script>
/* ========== CONFIG ========== */
const SHEET_API_URL = "https://Mistergreenbets.github.io/RabiscoeArte/produtos.json";
const telefone = "5585994083703";

/* ========== ESTADO GLOBAL ========== */
let produtos = [];
let paginaAtual = 1;
let categoriaAtual = "todos";
const produtosPorPagina = 6;

let precoAtual = 0;        // pre√ßo do produto antes do cupom (n√∫mero)
let totalFinal = 0;        // pre√ßo final (ap√≥s cupom)
let produtoAtualNome = ""; // nome do produto para o modal

/* ========== HELPERS ========== */
function safeString(v){ return String(v || "").trim(); }

/* ========== CARREGAR PRODUTOS ========== */
async function carregarProdutos(){
  try{
    const res = await fetch(SHEET_API_URL);
    const data = await res.json();

    // normalizar categorias e garantir campos m√≠nimos
    produtos = data.map(p => ({
      nome: safeString(p.nome),
      preco: Number(String(p.preco).replace(",", ".")) || 0,
      categoria: safeString(p.categoria).toLowerCase(),
      imagem: safeString(p.imagem),
      descricao: safeString(p.descricao),
      badge: safeString(p.badge)
    }));

    renderizarCards();
    iniciarSistemaCatalogo();
  }catch(err){
    console.error("Erro ao carregar produtos:", err);
    document.getElementById("catalogo").innerHTML = "<p style='text-align:center;color:red;'>Erro ao carregar produtos.</p>";
  }
}

/* ========== RENDER CARDS (uso data-attrs para robustez) ========== */
function renderizarCards(){
  const catalogo = document.getElementById("catalogo");
  catalogo.innerHTML = "";

  produtos.forEach(p => {
    const precoStr = p.preco.toFixed(2);
    const card = document.createElement("div");
    card.className = "produto";
    card.setAttribute("data-categoria", p.categoria);
    card.setAttribute("data-nome", p.nome);
    card.setAttribute("data-preco", p.preco);
    card.setAttribute("data-imagem", p.imagem);
    card.innerHTML = `
      ${p.badge ? `<span class="badge">${p.badge}</span>` : ""}
      <div class="produto-img"><img src="${p.imagem}" alt="${p.nome}"></div>
      <div class="produto-content">
        <h2>${p.nome}</h2>
        <p>${p.descricao}</p>
        <p class="preco">R$ ${precoStr}</p>
      </div>
      <div class="actions">
        <button type="button" class="btn-encomendar">ENCOMENDAR AGORA</button>
      </div>
    `;
    catalogo.appendChild(card);
  });

  // ligar eventos dos bot√µes de cada card (robusto, evita problemas com aspas)
  document.querySelectorAll(".btn-encomendar").forEach(btn=>{
    btn.addEventListener("click", function(){
      const card = this.closest(".produto");
      abrirModalFromCard(card);
    });
  });
}

/* ========== ABRIR MODAL (via elemento card) ========== */
function abrirModalFromCard(card){
  const nome = card.dataset.nome;
  const preco = parseFloat(card.dataset.preco) || 0;
  const imagem = card.dataset.imagem || "";

  // preencher globals
  precoAtual = Number(preco);
  totalFinal = precoAtual;
  produtoAtualNome = nome;

  // atualizar modal UI
  document.getElementById("produtoNome").innerText = `${nome} ‚Äî R$ ${precoAtual.toFixed(2)}`;
  document.getElementById("modalImg").src = imagem;
  document.getElementById("total").innerHTML = `Total: <b>R$ ${precoAtual.toFixed(2)}</b>`;

  // mostrar modal
  document.getElementById("modal").style.display = "flex";
  document.getElementById("modal").setAttribute("aria-hidden","false");

  gerarVisualizacoes();

}

/* ========== ATUALIZAR TOTAL (cupom) ========== */
async function atualizarTotal(){
  const cupom = String(document.getElementById("cupom").value || "").trim().toUpperCase();
  const campoDesconto = document.getElementById("desconto");
  const campoTotal = document.getElementById("total");

  // exibe total base enquanto valida
  campoTotal.innerHTML = `Total: <b>R$ ${precoAtual.toFixed(2)}</b>`;
  totalFinal = precoAtual;

  if(!cupom){
    campoDesconto.innerText = "";
    return;
  }

  campoDesconto.innerText = "Validando cupom... ‚è≥";
  try{
    // construir URL corretamente (CUPOM_API_URL n√£o deve conter ?cupom=)
    const url = `${CUPOM_API_URL}?cupom=${encodeURIComponent(cupom)}`;
    const res = await fetch(url);
    const data = await res.json();
    console.log("Retorno cupom API:", data);

    // espera-se { valido: true/false, desconto: <percentual>, mensagem: "..." }
    if(data && (data.valido === true || data.status === "valido")){
      // suporta ambos formatos: porcentagem em data.desconto ou data.valor dependendo do script
      const percentual = Number(data.desconto ?? data.valor ?? 0);
      const descontoValor = precoAtual * (percentual / 100);
      totalFinal = precoAtual - descontoValor;

      campoDesconto.innerText = ` ${data.mensagem || "Cupom aplicado!"}`;
      campoTotal.innerHTML = `Total: <b>R$ ${totalFinal.toFixed(2)}</b>`;
    } else {
      campoDesconto.innerText = `‚ùå ${data.mensagem || "Cupom inv√°lido"}`;
      campoTotal.innerHTML = `Total: <b>R$ ${precoAtual.toFixed(2)}</b>`;
      totalFinal = precoAtual;
    }
  }catch(err){
    console.error("Erro ao validar cupom:", err);
    campoDesconto.innerText = "Erro ao validar cupom ‚ùå";
    campoTotal.innerHTML = `Total: <b>R$ ${precoAtual.toFixed(2)}</b>`;
    totalFinal = precoAtual;
  }
}

/* ========== GERAR VISUALIZA√á√ïES ========== */
function gerarVisualizacoes(){
  const pessoas = Math.floor(Math.random()*11)+5;
  document.getElementById("viewers").innerText = `${pessoas} pessoas visualizaram esse produto agora üî•`;
}

/* ========== FECHAR MODAL ========== */
function fecharModal(){
  document.getElementById("modal").style.display = "none";
  document.getElementById("modal").setAttribute("aria-hidden","true");
}

/* ========== ENVIAR PARA WHATSAPP ========== */
function enviarPedido(){
  const nomeCliente = document.getElementById("nome").value.trim();
  const cidade = document.getElementById("cidade").value.trim();

  if(!nomeCliente){
    alert("Digite seu nome.");
    return;
  }

  const afiliado = localStorage.getItem("afiliado") || "SEM_AFILIADO";
  const totalTexto = totalFinal.toFixed(2);

  const msg = `üõí *Pedido*

Produto: ${produtoAtualNome}
Valor: R$ ${totalTexto}

üë§ Nome: ${nomeCliente}
üèôÔ∏è Cidade: ${cidade}`;

  /* REGISTRO NO GOOGLE SCRIPT */
  fetch("https://script.google.com/macros/s/AKfycbxFP5o5as58xAajbT2McLckEBxYHlv3-pZFFGb3HQTJcieOln2o1bhl0genO8ywgq_A/exec" +
    `?afiliado=${afiliado}` +
    `&produto=${encodeURIComponent(produtoAtualNome)}` +
    `&valor=${totalTexto}` +
    `&cliente=${encodeURIComponent(nomeCliente)}` +
    `&cidade=${encodeURIComponent(cidade)}`
  );

  window.location.href =
    `https://wa.me/${telefone}?text=${encodeURIComponent(msg)}`;
}


/* ========== FILTRO E PAGINA√á√ÉO ========== */
const btnPrev = document.getElementById("prev");
const btnNext = document.getElementById("next");
const infoPagina = document.getElementById("page-info");
const filtroContainer = document.getElementById("filtroContainer");

filtroContainer.querySelectorAll("button").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    const cat = btn.getAttribute("data-cat");
    filtroContainer.querySelectorAll("button").forEach(b=>b.classList.remove("ativo"));
    btn.classList.add("ativo");
    categoriaAtual = (cat||"todos").toLowerCase();
    paginaAtual = 1;
    iniciarSistemaCatalogo();
  });
});

function iniciarSistemaCatalogo(){
  mostrarProdutos();
}

/* mostrarProdutos com checagens e normaliza√ß√£o */
function mostrarProdutos(){
  const todosProdutos = Array.from(document.querySelectorAll(".produto"));
  const filtrados = todosProdutos.filter(prod => {
    const cat = String(prod.getAttribute("data-categoria") || "").toLowerCase();
    return categoriaAtual === "todos" || cat === categoriaAtual;
  });

  const totalPaginas = Math.max(1, Math.ceil(filtrados.length / produtosPorPagina));

  todosProdutos.forEach(p => {
    p.style.display = "none";
    p.classList.remove("visivel");
  });

  if(filtrados.length === 0){
    infoPagina.innerText = "Nenhum produto encontrado";
    btnPrev.disabled = true;
    btnNext.disabled = true;
    return;
  }

  // garantir paginaAtual dentro dos limites
  if(paginaAtual < 1) paginaAtual = 1;
  if(paginaAtual > totalPaginas) paginaAtual = totalPaginas;

  const inicio = (paginaAtual - 1) * produtosPorPagina;
  const slice = filtrados.slice(inicio, inicio + produtosPorPagina);

  slice.forEach((p, i) => {
    p.style.display = "block";
    setTimeout(()=>p.classList.add("visivel"), 40 * i);
  });

  infoPagina.innerText = `P√°gina ${paginaAtual} de ${totalPaginas}`;
  btnPrev.disabled = paginaAtual === 1;
  btnNext.disabled = paginaAtual >= totalPaginas;
}

/* PAGINA√á√ÉO com limites */
btnPrev.addEventListener("click", ()=>{
  if(paginaAtual > 1){
    paginaAtual--;
    mostrarProdutos();
    window.scrollTo({ top: 200, behavior: "smooth" });
  }
});
btnNext.addEventListener("click", ()=>{
  // n√£o ultrapassar o limite (mostrarProdutos atualiza totalPaginas)
  const todosProdutos = Array.from(document.querySelectorAll(".produto"));
  const filtrados = todosProdutos.filter(prod => {
    const cat = String(prod.getAttribute("data-categoria") || "").toLowerCase();
    return categoriaAtual === "todos" || cat === categoriaAtual;
  });
  const totalPaginas = Math.max(1, Math.ceil(filtrados.length / produtosPorPagina));
  if(paginaAtual < totalPaginas){
    paginaAtual++;
    mostrarProdutos();
    window.scrollTo({ top: 200, behavior: "smooth" });
  }
});

/* ========== START ========== */
document.addEventListener("DOMContentLoaded", carregarProdutos);
</script>

</body>
</html>
